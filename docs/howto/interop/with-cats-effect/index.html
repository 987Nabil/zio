<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>How to Interop with Cats Effect? · ZIO</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="## Introduction"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="How to Interop with Cats Effect? · ZIO"/><meta property="og:type" content="website"/><meta property="og:url" content="https://zio.dev/"/><meta property="og:description" content="## Introduction"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100,"cornerOffset":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/navbar_brand.png" alt="ZIO"/><h2 class="headerTitleWithLogo">ZIO</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/overview/overview_index" target="_self">Overview</a></li><li class=""><a href="/docs/datatypes/" target="_self">Data Types</a></li><li class=""><a href="/docs/services/" target="_self">Services</a></li><li class=""><a href="/docs/usecases/usecases_index" target="_self">Use Cases</a></li><li class="siteNavGroupActive"><a href="/docs/howto/" target="_self">How to</a></li><li class=""><a href="/docs/resources/" target="_self">Resources</a></li><li class=""><a href="/docs/about/about_index" target="_self">About</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Interop</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Overview<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/howto/">Summary</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">How to<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/howto/use-test-assertions">How to Use Test Assertions</a></li><li class="navListItem"><a class="navItem" href="/docs/howto/test-effects">How to Test effects?</a></li><li class="navListItem"><a class="navItem" href="/docs/howto/mock-services">How to Mock Services?</a></li><li class="navListItem"><a class="navItem" href="/docs/howto/handle-errors">How to Handle Errors?</a></li><li class="navListItem"><a class="navItem" href="/docs/howto/access-system-information">How to Access System Information?</a></li><li class="navListItem"><a class="navItem" href="/docs/howto/use-zio-macros">How to use ZIO Macros?</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Interop<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem navListItemActive"><a class="navItem" href="/docs/howto/interop/with-cats-effect">How to Interop with Cats Effect?</a></li><li class="navListItem"><a class="navItem" href="/docs/howto/interop/with-future">How to Interop with Future?</a></li><li class="navListItem"><a class="navItem" href="/docs/howto/interop/with-java">How to Interop with Java?</a></li><li class="navListItem"><a class="navItem" href="/docs/howto/interop/with-javascript">How to Interop with JavaScript?</a></li><li class="navListItem"><a class="navItem" href="/docs/howto/interop/with-monix">How to Interop with Monix?</a></li><li class="navListItem"><a class="navItem" href="/docs/howto/interop/with-scalaz-7x">How to Interop with Scalaz 7.x?</a></li><li class="navListItem"><a class="navItem" href="/docs/howto/interop/with-reactive-streams">How to Interop with Reactive Streams?</a></li><li class="navListItem"><a class="navItem" href="/docs/howto/interop/with-twitter">How to Interop with Twitter?</a></li><li class="navListItem"><a class="navItem" href="/docs/howto/interop/with-guava">How to Interop with Guava?</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Migrate<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/howto/migrate/from-monix">How to Migrate from Monix to ZIO?</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/zio/zio/edit/master/docs/howto/interop/with-cats-effect.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 id="__docusaurus" class="postHeaderTitle">How to Interop with Cats Effect?</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="introduction"></a><a href="#introduction" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Introduction</h2>
<p><a href="https://github.com/zio/interop-cats"><code>interop-cats</code></a> has instances for the <a href="https://typelevel.org/cats/">Cats</a>, <a href="https://github.com/typelevel/cats-mtl">Cats MTL</a> and <a href="https://typelevel.org/cats-effect/">Cats Effect</a> libraries, which allow you to use ZIO with any libraries that rely on these, like <a href="https://github.com/tpolecat/doobie">Doobie</a>, <a href="https://github.com/http4s/http4s">Http4s</a>, <a href="https://github.com/functional-streams-for-scala/fs2">FS2</a> or <a href="https://github.com/circe/circe">Circe</a></p>
<p>Depends on which version of Cats Effect we are using, we should pick the right version of <code>zio-interop-cats</code>. In this tutorial, whenever we're working with Cats Effect 2.x, we are using:</p>
<pre><code class="hljs css language-scala">libraryDependencies += <span class="hljs-string">"dev.zio"</span> %% <span class="hljs-string">"zio-interop-cats"</span> % <span class="hljs-string">"2.5.1.0"</span>
</code></pre>
<p>And whenever we are using Cats Effect 3.x instances, we are using:</p>
<pre><code class="hljs css language-scala">libraryDependencies += <span class="hljs-string">"dev.zio"</span> %% <span class="hljs-string">"zio-interop-cats"</span> % <span class="hljs-string">"3.1.1.0"</span>
</code></pre>
<p>Most of the interop functionality resides in the following package:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> zio.interop.catz._
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="cats-effect-instances"></a><a href="#cats-effect-instances" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cats Effect Instances</h2>
<p>ZIO integrates with Typelevel libraries by providing instances of Cats Effect type classes. These type classes are used by <code>fs2</code>, <code>doobie</code>, <code>http4s</code>, and a variety of other libraries in the functional Scala ecosystem.</p>
<p>Due to the limitations of the Cats Effect, ZIO cannot provide instances for arbitrary error types. Instead, we can obtain instances only for effects whose error type extends <code>Throwable</code>.</p>
<p>For convenience, ZIO includes the <code>Task</code> and <code>RIO</code> type aliases, which fix the error type to <code>Throwable</code>, and may be useful for interop with Cats Effect:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> zio.{<span class="hljs-type">ZIO</span>, <span class="hljs-type">Task</span>, <span class="hljs-type">RIO</span>}
</code></pre>
<pre><code class="hljs css language-scala"><span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">Task</span>[+<span class="hljs-type">A</span>]    </span>= <span class="hljs-type">ZIO</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Throwable</span>, <span class="hljs-type">A</span>]
<span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">RIO</span>[-<span class="hljs-type">R</span>, +<span class="hljs-type">A</span>] </span>= <span class="hljs-type">ZIO</span>[  <span class="hljs-type">R</span>, <span class="hljs-type">Throwable</span>, <span class="hljs-type">A</span>]
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="providing-runtime-manually"></a><a href="#providing-runtime-manually" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Providing Runtime Manually</h3>
<p>To use Cats Effect instances for these types, we should have an implicit <code>Runtime[R]</code> in scope for the environment type of our effects. The following code snippet creates an implicit <code>Runtime</code> for all the modules built into ZIO:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> cats.implicits._
<span class="hljs-keyword">import</span> zio.interop.catz._

<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">ZioCatsEffectInterop</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">scala</span>.<span class="hljs-title">App</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">catsEffectApp</span></span>[<span class="hljs-type">F</span>[_]: cats.effect.<span class="hljs-type">Sync</span>]: <span class="hljs-type">F</span>[<span class="hljs-type">Unit</span>] =
    cats.effect.<span class="hljs-type">Sync</span>[<span class="hljs-type">F</span>].delay(
        println(<span class="hljs-string">"Hello from Cats Effect World!"</span>)
      )
      
  <span class="hljs-keyword">implicit</span> <span class="hljs-keyword">val</span> runtime: zio.<span class="hljs-type">Runtime</span>[zio.<span class="hljs-type">ZEnv</span>] = zio.<span class="hljs-type">Runtime</span>.<span class="hljs-keyword">default</span>

  <span class="hljs-keyword">val</span> zioApp: zio.<span class="hljs-type">Task</span>[<span class="hljs-type">Unit</span>] = catsEffectApp[zio.<span class="hljs-type">Task</span>]
  runtime.unsafeRun(zioApp.exitCode)
}
</code></pre>
<p>If we are working with Cats Effect 3.x, the <code>catsEffectApp[Task]</code> will be expanded as if we called the following code explicitly:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> <span class="hljs-type">ZioCatsEffectInterop</span>.catsEffectApp
</code></pre>
<pre><code class="hljs css language-scala"><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">ZioCatsEffectInterop</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">scala</span>.<span class="hljs-title">App</span> </span>{
  <span class="hljs-keyword">val</span> runtime: zio.<span class="hljs-type">Runtime</span>[zio.<span class="hljs-type">ZEnv</span>] = zio.<span class="hljs-type">Runtime</span>.<span class="hljs-keyword">default</span>
  
  <span class="hljs-keyword">val</span> zioApp: zio.<span class="hljs-type">Task</span>[<span class="hljs-type">Unit</span>] = catsEffectApp[zio.<span class="hljs-type">Task</span>](
    zio.interop.catz.asyncRuntimeInstance(runtime) 
  )
  
  runtime.unsafeRun(zioApp.exitCode) 
}
</code></pre>
<p>And if we are working with Cats Effect 2.x, it will be expanded as if we called following code explicitly:</p>
<pre><code class="hljs css language-scala"><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">ZioCatsEffectInterop</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">scala</span>.<span class="hljs-title">App</span> </span>{
  <span class="hljs-keyword">val</span> runtime: zio.<span class="hljs-type">Runtime</span>[zio.<span class="hljs-type">ZEnv</span>] = zio.<span class="hljs-type">Runtime</span>.<span class="hljs-keyword">default</span>

  <span class="hljs-keyword">val</span> zioApp = catsEffectApp[zio.<span class="hljs-type">Task</span>](zio.interop.catz.taskConcurrentInstance)
  runtime.unsafeRun(zioApp.exitCode)
}
</code></pre>
<p>If we are using <code>RIO</code> for a custom environment <code>R</code>, then we will have to create our own <code>Runtime[R]</code>, and ensure that implicit wherever we need Cats Effect instances.</p>
<h3><a class="anchor" aria-hidden="true" id="using-catsapp-runtime"></a><a href="#using-catsapp-runtime" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using <code>CatsApp</code> Runtime</h3>
<p>As a convenience, our application can extend <code>CatsApp</code>, which automatically brings an implicit <code>Runtime[ZEnv]</code> into our scope:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> zio.interop.catz._
<span class="hljs-keyword">import</span> cats.implicits._

<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">ZioCatsEffectInteropWithCatsApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CatsApp</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">catsEffectApp</span></span>[<span class="hljs-type">F</span>[_]: cats.effect.<span class="hljs-type">Sync</span>]: <span class="hljs-type">F</span>[<span class="hljs-type">Unit</span>] =
    cats.effect.<span class="hljs-type">Sync</span>[<span class="hljs-type">F</span>].delay(println(<span class="hljs-string">"Hello from Cats Effect World!"</span>))

  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span></span>(args: <span class="hljs-type">List</span>[<span class="hljs-type">String</span>]): zio.<span class="hljs-type">URIO</span>[zio.<span class="hljs-type">ZEnv</span>, zio.<span class="hljs-type">ExitCode</span>] = 
    catsEffectApp[zio.<span class="hljs-type">Task</span>].exitCode
}
</code></pre>
<p>This example works properly in both Cats Effect 2.x and 3.x versions.</p>
<h2><a class="anchor" aria-hidden="true" id="cats-effect-2x"></a><a href="#cats-effect-2x" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cats Effect 2.x</h2>
<h3><a class="anchor" aria-hidden="true" id="timer-instance"></a><a href="#timer-instance" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Timer Instance</h3>
<p>In order to get a <code>cats.effect.Timer[zio.Task]</code> instance, we need an extra import (<code>zio.interop.catz.implicits._</code>):</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> java.util.concurrent.<span class="hljs-type">TimeUnit</span>

<span class="hljs-keyword">import</span> cats.implicits._
<span class="hljs-keyword">import</span> zio.interop.catz._
<span class="hljs-keyword">import</span> zio.interop.catz.implicits._ <span class="hljs-comment">// Provides `zio.Task instance` for `cats.effect.Time` type class</span>
<span class="hljs-keyword">import</span> zio.{ <span class="hljs-type">ExitCode</span>, <span class="hljs-type">Task</span>, <span class="hljs-type">URIO</span> }

<span class="hljs-keyword">import</span> scala.concurrent.duration.<span class="hljs-type">DurationInt</span>

<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">ZioCatsEffectTimerInterop</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">zio</span>.<span class="hljs-title">interop</span>.<span class="hljs-title">catz</span>.<span class="hljs-title">CatsApp</span> </span>{
  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span></span>(args: <span class="hljs-type">List</span>[<span class="hljs-type">String</span>]): zio.<span class="hljs-type">URIO</span>[zio.<span class="hljs-type">ZEnv</span>, zio.<span class="hljs-type">ExitCode</span>] =
    catsEffectTimerApp[zio.<span class="hljs-type">Task</span>].exitCode

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">catsEffectTimerApp</span></span>[<span class="hljs-type">F</span>[_]: cats.effect.<span class="hljs-type">Clock</span>: cats.effect.<span class="hljs-type">Timer</span>: cats.effect.<span class="hljs-type">Sync</span>]: <span class="hljs-type">F</span>[<span class="hljs-type">Unit</span>] = <span class="hljs-keyword">for</span> {
    t2 &lt;- cats.effect.<span class="hljs-type">Clock</span>[<span class="hljs-type">F</span>].monotonic(<span class="hljs-type">TimeUnit</span>.<span class="hljs-type">SECONDS</span>)
    _  &lt;- cats.effect.<span class="hljs-type">Timer</span>[<span class="hljs-type">F</span>].sleep(<span class="hljs-number">2.</span>seconds)
    t1 &lt;- cats.effect.<span class="hljs-type">Clock</span>[<span class="hljs-type">F</span>].monotonic(<span class="hljs-type">TimeUnit</span>.<span class="hljs-type">SECONDS</span>)
    _  &lt;- cats.effect.<span class="hljs-type">Sync</span>[<span class="hljs-type">F</span>].delay(println(t1 - t2))
  } <span class="hljs-keyword">yield</span> ()
}
</code></pre>
<p>The reason a <code>cats.effect.Timer[zio.Task]</code> instance is not provided by the default <em>interop</em> import is that it makes testing programs that require timing capabilities very difficult. The extra import (wherever needed) makes reasoning about timing-related effects much easier.</p>
<p>If we're using <code>RIO</code> for a custom environment then our environment must use the <code>Clock</code> service, e.g. <code>R &lt;: Clock</code> to get a timer.</p>
<h3><a class="anchor" aria-hidden="true" id="converting-resource-to-zmanaged"></a><a href="#converting-resource-to-zmanaged" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Converting Resource to ZManaged</h3>
<p>To convert Cats Effect <code>Resource</code> into <code>ZManaged</code>, we can call <code>toManaged</code> on <code>Resource</code>.</p>
<p>For example, assume we have the following <code>File</code> API:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">File</span>[<span class="hljs-type">F</span>[_]</span>: cats.effect.<span class="hljs-type">Sync</span>]() {
  <span class="hljs-keyword">import</span> cats.syntax.apply._
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read</span></span>: <span class="hljs-type">F</span>[<span class="hljs-type">String</span>] =
    cats.effect.<span class="hljs-type">Sync</span>[<span class="hljs-type">F</span>].delay(println(<span class="hljs-string">"Reading file."</span>)) *&gt;
      cats.effect.<span class="hljs-type">Sync</span>[<span class="hljs-type">F</span>].pure(<span class="hljs-string">"Hello, World!"</span>)
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">close</span></span>: <span class="hljs-type">F</span>[<span class="hljs-type">Unit</span>]  =
    cats.effect.<span class="hljs-type">Sync</span>[<span class="hljs-type">F</span>].delay(println(<span class="hljs-string">"Closing file."</span>))
}

<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">File</span> </span>{
  <span class="hljs-keyword">import</span> cats.syntax.apply._
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">open</span></span>[<span class="hljs-type">F</span>[_]: cats.effect.<span class="hljs-type">Sync</span>](name: <span class="hljs-type">String</span>): <span class="hljs-type">F</span>[<span class="hljs-type">File</span>[<span class="hljs-type">F</span>]] =
    cats.effect.<span class="hljs-type">Sync</span>[<span class="hljs-type">F</span>].delay(println(<span class="hljs-string">s"opening <span class="hljs-subst">$name</span> file"</span>)) *&gt;
      cats.effect.<span class="hljs-type">Sync</span>[<span class="hljs-type">F</span>].delay(<span class="hljs-type">File</span>())
}
</code></pre>
<p>And, also assume we have <code>fileResource</code> defined as follows:</p>
<pre><code class="hljs css language-scala"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fileResource</span></span>[<span class="hljs-type">F</span>[_]: cats.effect.<span class="hljs-type">Sync</span>](name: <span class="hljs-type">String</span>): cats.effect.<span class="hljs-type">Resource</span>[<span class="hljs-type">F</span>, <span class="hljs-type">File</span>[<span class="hljs-type">F</span>]] =
  cats.effect.<span class="hljs-type">Resource</span>.make(<span class="hljs-type">File</span>.open[<span class="hljs-type">F</span>](name))(_.close)
</code></pre>
<p>Let's convert that to <code>ZManaged</code>:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> resource: zio.<span class="hljs-type">ZManaged</span>[zio.<span class="hljs-type">ZEnv</span>, <span class="hljs-type">Throwable</span>, <span class="hljs-type">File</span>[zio.<span class="hljs-type">Task</span>]] =
  fileResource[zio.<span class="hljs-type">Task</span>](<span class="hljs-string">"log.txt"</span>).toManaged[zio.<span class="hljs-type">ZEnv</span>]
</code></pre>
<p>Here is a complete working example:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> zio.interop.catz._

<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">CatsEffectResourceInterop</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CatsApp</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fileResource</span></span>[<span class="hljs-type">F</span>[_]: cats.effect.<span class="hljs-type">Sync</span>](name: <span class="hljs-type">String</span>): cats.effect.<span class="hljs-type">Resource</span>[<span class="hljs-type">F</span>, <span class="hljs-type">File</span>[<span class="hljs-type">F</span>]] =
    cats.effect.<span class="hljs-type">Resource</span>.make(<span class="hljs-type">File</span>.open[<span class="hljs-type">F</span>](name))(_.close)

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">myApp</span></span>: zio.<span class="hljs-type">ZIO</span>[zio.<span class="hljs-type">ZEnv</span>, <span class="hljs-type">Throwable</span>, <span class="hljs-type">Unit</span>] = <span class="hljs-keyword">for</span> {
    c &lt;- fileResource[zio.<span class="hljs-type">Task</span>](<span class="hljs-string">"log.txt"</span>).toManaged[zio.<span class="hljs-type">ZEnv</span>].use(_.read)
    _ &lt;- zio.console.putStr(<span class="hljs-string">s"file content: <span class="hljs-subst">$c</span>"</span>)
  } <span class="hljs-keyword">yield</span> ()

  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span></span>(args: <span class="hljs-type">List</span>[<span class="hljs-type">String</span>]): zio.<span class="hljs-type">URIO</span>[zio.<span class="hljs-type">ZEnv</span>, zio.<span class="hljs-type">ExitCode</span>] =
    myApp.exitCode
}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="converting-zmanaged-to-resource"></a><a href="#converting-zmanaged-to-resource" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Converting ZManaged to Resource</h3>
<p>We have an extension method on <code>ZManaged</code> called <code>ZManaged#toResource</code> which converts a ZIO managed resource to Cats Effect resource:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ZManagedSyntax</span>[<span class="hljs-type">R</span>, <span class="hljs-type">E</span>, <span class="hljs-type">A</span>](<span class="hljs-params">private val managed: <span class="hljs-type">ZManaged</span>[<span class="hljs-type">R</span>, <span class="hljs-type">E</span>, <span class="hljs-type">A</span>]</span>) </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">toResource</span></span>[<span class="hljs-type">F</span>[_]](<span class="hljs-keyword">implicit</span>
      <span class="hljs-type">F</span>: <span class="hljs-type">Async</span>[<span class="hljs-type">F</span>],
      ev: <span class="hljs-type">Effect</span>[<span class="hljs-type">ZIO</span>[<span class="hljs-type">R</span>, <span class="hljs-type">E</span>, *]]
  ): <span class="hljs-type">Resource</span>[<span class="hljs-type">F</span>, <span class="hljs-type">A</span>] = ???
}
</code></pre>
<p>Let's try an example:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> zio.interop.catz._

<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">ZManagedToResource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">cats</span>.<span class="hljs-title">effect</span>.<span class="hljs-title">IOApp</span> </span>{
  <span class="hljs-keyword">implicit</span> <span class="hljs-keyword">val</span> zioRuntime: zio.<span class="hljs-type">Runtime</span>[zio.<span class="hljs-type">ZEnv</span>] = zio.<span class="hljs-type">Runtime</span>.<span class="hljs-keyword">default</span>

  <span class="hljs-keyword">val</span> resource: cats.effect.<span class="hljs-type">Resource</span>[cats.effect.<span class="hljs-type">IO</span>, java.io.<span class="hljs-type">InputStream</span>] =
    zio.<span class="hljs-type">ZManaged</span>
      .fromAutoCloseable(
        zio.<span class="hljs-type">ZIO</span>.effect(
          java.nio.file.<span class="hljs-type">Files</span>.newInputStream(
            java.nio.file.<span class="hljs-type">Paths</span>.get(<span class="hljs-string">"file.txt"</span>)
          )
        )
      )
      .toResource[cats.effect.<span class="hljs-type">IO</span>]

  <span class="hljs-keyword">val</span> effect: cats.effect.<span class="hljs-type">IO</span>[<span class="hljs-type">Unit</span>] =
    resource
      .use { is =&gt;
        cats.effect.<span class="hljs-type">IO</span>.delay(is.readAllBytes())
      }
      .flatMap(bytes =&gt;
        cats.effect.<span class="hljs-type">IO</span>.delay(
          println(<span class="hljs-string">s"file length: <span class="hljs-subst">${bytes.length}</span>"</span>)
        )
      )

  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span></span>(args: <span class="hljs-type">List</span>[<span class="hljs-type">String</span>]): cats.effect.<span class="hljs-type">IO</span>[cats.effect.<span class="hljs-type">ExitCode</span>] =
    effect.as(cats.effect.<span class="hljs-type">ExitCode</span>.<span class="hljs-type">Success</span>)
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="cats-effect-3x"></a><a href="#cats-effect-3x" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cats Effect 3.x</h2>
<h3><a class="anchor" aria-hidden="true" id="type-class-instances-for-zios-task"></a><a href="#type-class-instances-for-zios-task" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Type class Instances for ZIO's Task</h3>
<p>ZIO integrates with Cats Effect 3.x as well as 2.x. The <code>interop-cats</code> module provides <code>Concurrent</code>, <code>Temporal</code> and <code>Async</code> for <code>zio.Task</code>.</p>
<p>An example of ZIO interoperability with CE3:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> cats.implicits._
<span class="hljs-keyword">import</span> zio.interop.catz._
<span class="hljs-keyword">import</span> scala.concurrent.duration.<span class="hljs-type">DurationInt</span>

<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">ZioCatsEffectInterop</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">zio</span>.<span class="hljs-title">interop</span>.<span class="hljs-title">catz</span>.<span class="hljs-title">CatsApp</span> </span>{

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">catsEffectTimerApp</span></span>[<span class="hljs-type">F</span>[_]: cats.effect.<span class="hljs-type">Async</span>]: <span class="hljs-type">F</span>[<span class="hljs-type">Unit</span>] = <span class="hljs-keyword">for</span> {
    t2 &lt;- cats.effect.<span class="hljs-type">Clock</span>[<span class="hljs-type">F</span>].monotonic
    _  &lt;- cats.effect.<span class="hljs-type">Temporal</span>[<span class="hljs-type">F</span>].sleep(<span class="hljs-number">2.</span>seconds)
    t1 &lt;- cats.effect.<span class="hljs-type">Clock</span>[<span class="hljs-type">F</span>].monotonic
    _  &lt;- cats.effect.<span class="hljs-type">Sync</span>[<span class="hljs-type">F</span>].delay(println(t1 - t2))
  } <span class="hljs-keyword">yield</span> ()
  
  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span></span>(args: <span class="hljs-type">List</span>[<span class="hljs-type">String</span>]): zio.<span class="hljs-type">URIO</span>[zio.<span class="hljs-type">ZEnv</span>, zio.<span class="hljs-type">ExitCode</span>] = {
    catsEffectTimerApp[zio.<span class="hljs-type">Task</span>].exitCode
  }
}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="converting-resource-to-zmanaged-1"></a><a href="#converting-resource-to-zmanaged-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Converting Resource to ZManaged</h3>
<p>To convert a Cats Effect's <code>Resource</code> to <code>ZManaged</code> we can use <code>cats.effect.Resource#toZManaged</code> extension method by importing <code>zio.interop.catz._</code> package and also we should provide an implicit instance of <code>Dispatcher</code>:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> zio.interop.catz._
<span class="hljs-keyword">import</span> scala.concurrent.<span class="hljs-type">ExecutionContextExecutor</span>

<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">ResourceToZManagedExample</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">zio</span>.<span class="hljs-title">App</span> </span>{
  <span class="hljs-keyword">implicit</span> <span class="hljs-keyword">val</span> ceRuntime: cats.effect.unsafe.<span class="hljs-type">IORuntime</span> =
    cats.effect.unsafe.<span class="hljs-type">IORuntime</span>.global
  <span class="hljs-keyword">implicit</span> <span class="hljs-keyword">val</span> ec: <span class="hljs-type">ExecutionContextExecutor</span> =
    scala.concurrent.<span class="hljs-type">ExecutionContext</span>.global

  <span class="hljs-keyword">implicit</span> <span class="hljs-keyword">val</span> dispatcher: cats.effect.std.<span class="hljs-type">Dispatcher</span>[cats.effect.<span class="hljs-type">IO</span>] =
    cats.effect.std
      .<span class="hljs-type">Dispatcher</span>[cats.effect.<span class="hljs-type">IO</span>]
      .allocated
      .unsafeRunSync()
      ._1

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">catsResource</span></span>[<span class="hljs-type">F</span>[_]: cats.effect.<span class="hljs-type">Sync</span>]
      : cats.effect.<span class="hljs-type">Resource</span>[<span class="hljs-type">F</span>, java.io.<span class="hljs-type">InputStream</span>] =
    cats.effect.<span class="hljs-type">Resource</span>
      .fromAutoCloseable(
        cats.effect
          .<span class="hljs-type">Sync</span>[<span class="hljs-type">F</span>]
          .delay(
            java.nio.file.<span class="hljs-type">Files</span>.newInputStream(
              java.nio.file.<span class="hljs-type">Paths</span>.get(<span class="hljs-string">"file.txt"</span>)
            )
          )
      )

  <span class="hljs-keyword">val</span> myApp: zio.<span class="hljs-type">ZIO</span>[zio.console.<span class="hljs-type">Console</span>, <span class="hljs-type">Throwable</span>, <span class="hljs-type">Unit</span>] =
    catsResource[cats.effect.<span class="hljs-type">IO</span>].toManaged
      .use { is =&gt;
        zio.console.putStrLn(is.readAllBytes().length.toString)
      }
      
  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span></span>(args: <span class="hljs-type">List</span>[<span class="hljs-type">String</span>]): zio.<span class="hljs-type">URIO</span>[zio.<span class="hljs-type">ZEnv</span>, zio.<span class="hljs-type">ExitCode</span>] =
    myApp.exitCode
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="cats-core"></a><a href="#cats-core" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cats Core</h2>
<p>There is another package in <code>interop-cats</code> module called <code>zio.interop.catz.core._</code> which helps us to interop with core data types. This package contains instances of <code>zio.Chunk</code> data type for Cats Core module like <code>cats.Order</code>, <code>cats.Hash</code>, <code>cats.Traverse</code>, and so forth.</p>
<p>In the following example, we are going to use <code>zio.Chunk</code> in a Cats Effect application:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> cats.implicits._
<span class="hljs-keyword">import</span> zio.interop.catz.core._

<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">ZioInteropWithCatsCore</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">cats</span>.<span class="hljs-title">effect</span>.<span class="hljs-title">IOApp</span> </span>{
  <span class="hljs-keyword">val</span> chunk = zio.<span class="hljs-type">Chunk</span>(<span class="hljs-string">"1"</span>, <span class="hljs-string">"2"</span>, <span class="hljs-string">"3"</span>, <span class="hljs-string">"4"</span>, <span class="hljs-string">"5"</span>)

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parseInt</span></span>(s: <span class="hljs-type">String</span>): <span class="hljs-type">Option</span>[<span class="hljs-type">Int</span>] =
    <span class="hljs-type">Either</span>.catchOnly[<span class="hljs-type">NumberFormatException</span>](s.toInt).toOption

  <span class="hljs-keyword">val</span> parseAll = cats.<span class="hljs-type">Traverse</span>[zio.<span class="hljs-type">Chunk</span>].traverse(chunk)(parseInt)

  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span></span>(args: <span class="hljs-type">List</span>[<span class="hljs-type">String</span>]): cats.effect.<span class="hljs-type">IO</span>[cats.effect.<span class="hljs-type">ExitCode</span>] =
    cats.effect.<span class="hljs-type">IO</span>.println(parseAll).as(cats.effect.<span class="hljs-type">ExitCode</span>.<span class="hljs-type">Success</span>)
}
</code></pre>
<p>This package also contains utilities to support <code>zio.NonEmptyChunk</code> interoperability with Cats Core module.</p>
<h2><a class="anchor" aria-hidden="true" id="fs2-streams"></a><a href="#fs2-streams" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>FS2 Streams</h2>
<p>The <code>interop-cats</code> module contains extension methods to convert <em>FS2 Stream</em> to <em>ZStream</em> and vice versa. These methods support both FS2 series, 2.x and 3.x:</p>
<h3><a class="anchor" aria-hidden="true" id="from-fs2-stream-to-zstream"></a><a href="#from-fs2-stream-to-zstream" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>From FS2 Stream to ZStream</h3>
<p>By importing <code>zio.stream.interop.fs2z._</code> into our application, the <code>fs2.Stream#toZStream</code> extension method converts a <code>fs2.Stream</code> to <code>ZStream</code>:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> zio.stream.<span class="hljs-type">ZStream</span>
<span class="hljs-keyword">import</span> zio.stream.interop.fs2z._
<span class="hljs-keyword">val</span> zstream: <span class="hljs-type">ZStream</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Throwable</span>, <span class="hljs-type">Int</span>] = fs2.<span class="hljs-type">Stream</span>.range(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>).toZStream()
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="from-zstream-to-fs2-stream"></a><a href="#from-zstream-to-fs2-stream" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>From ZStream to FS2 Stream</h3>
<p>Also, the <code>ZStream#toFs2Stream</code> converts a ZIO Stream into FS2 Stream:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> zio.stream.<span class="hljs-type">ZStream</span>
<span class="hljs-keyword">import</span> zio.<span class="hljs-type">Chunk</span>
<span class="hljs-keyword">import</span> zio.stream.interop.fs2z._
<span class="hljs-keyword">val</span> fs2stream = <span class="hljs-type">ZStream</span>.fromChunks(<span class="hljs-type">Chunk</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>)).toFs2Stream
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="using-zqueue-with-cats-effect"></a><a href="#using-zqueue-with-cats-effect" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using ZQueue with Cats Effect</h2>
<p>The <code>interop-cats</code> library has an <code>import zio.interop.Queue</code> package to lift creation of <code>ZQueue</code> effect from <code>UIO[Queue[A]]</code> to <code>F[Queue[F, A]]</code> which enables us to run <code>ZQueue</code> under Cats Effect runtime. It supports all variants of <code>ZQueue</code> like <code>bounded</code>, <code>unbounded</code>, <code>sliding</code> and <code>dropping</code>.</p>
<pre><code class="hljs css language-scala"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">bounded</span></span>[<span class="hljs-type">F</span>[+_], <span class="hljs-type">A</span>](capacity: <span class="hljs-type">Int</span>)(<span class="hljs-keyword">implicit</span> <span class="hljs-type">R</span>: <span class="hljs-type">Runtime</span>[<span class="hljs-type">ZEnv</span>], <span class="hljs-type">F</span>: <span class="hljs-type">LiftIO</span>[<span class="hljs-type">F</span>]): <span class="hljs-type">F</span>[<span class="hljs-type">Queue</span>[<span class="hljs-type">F</span>, <span class="hljs-type">A</span>]]
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="cats-effect-2x-1"></a><a href="#cats-effect-2x-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cats Effect 2.x</h3>
<p>In the following example, we are going to lift the <code>ZQueue</code> creation effect to Cats <code>IO</code> effect. If we are integrating with 2.x Cats Effect library, this snippet works properly:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> zio.interop.<span class="hljs-type">Queue</span>
<span class="hljs-keyword">import</span> cats.effect.<span class="hljs-type">IO</span>

<span class="hljs-keyword">implicit</span> <span class="hljs-keyword">val</span> runtime = <span class="hljs-type">Runtime</span>.<span class="hljs-keyword">default</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">liftedToIO</span></span>: <span class="hljs-type">IO</span>[<span class="hljs-type">List</span>[<span class="hljs-type">Int</span>]] = <span class="hljs-keyword">for</span> {
  q &lt;- <span class="hljs-type">Queue</span>.bounded[<span class="hljs-type">IO</span>, <span class="hljs-type">Int</span>](<span class="hljs-number">100</span>)
  _  &lt;- q.offer(<span class="hljs-number">1</span>)
  _  &lt;- q.offer(<span class="hljs-number">2</span>)
  r &lt;- q.takeAll
} <span class="hljs-keyword">yield</span> (r)
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="cats-effect-3x-1"></a><a href="#cats-effect-3x-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cats Effect 3.x</h3>
<p>To run <code>ZQueue</code> with Cats Effect 3.x we also need to provide an instance of <code>Dispatcher</code> to our contextual environment:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> zio.interop.<span class="hljs-type">Queue</span>

<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">ZioQueueInteropWithCats</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">scala</span>.<span class="hljs-title">App</span> </span>{

  <span class="hljs-keyword">implicit</span> <span class="hljs-keyword">val</span> ceRuntime: cats.effect.unsafe.<span class="hljs-type">IORuntime</span> =
    cats.effect.unsafe.<span class="hljs-type">IORuntime</span>.global

  <span class="hljs-keyword">implicit</span> <span class="hljs-keyword">val</span> zioRuntime: zio.<span class="hljs-type">Runtime</span>[zio.<span class="hljs-type">ZEnv</span>] =
    zio.<span class="hljs-type">Runtime</span>.<span class="hljs-keyword">default</span>

  <span class="hljs-keyword">implicit</span> <span class="hljs-keyword">val</span> ec: scala.concurrent.<span class="hljs-type">ExecutionContextExecutor</span> =
    scala.concurrent.<span class="hljs-type">ExecutionContext</span>.global

  <span class="hljs-keyword">implicit</span> <span class="hljs-keyword">val</span> dispatcher: cats.effect.std.<span class="hljs-type">Dispatcher</span>[cats.effect.<span class="hljs-type">IO</span>] =
    cats.effect.std
      .<span class="hljs-type">Dispatcher</span>[cats.effect.<span class="hljs-type">IO</span>]
      .allocated
      .unsafeRunSync()
      ._1

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">liftedToIO</span></span>: cats.effect.<span class="hljs-type">IO</span>[<span class="hljs-type">List</span>[<span class="hljs-type">Int</span>]] = <span class="hljs-keyword">for</span> {
    q &lt;- <span class="hljs-type">Queue</span>.bounded[cats.effect.<span class="hljs-type">IO</span>, <span class="hljs-type">Int</span>](<span class="hljs-number">100</span>)
    _ &lt;- q.offer(<span class="hljs-number">1</span>)
    _ &lt;- q.offer(<span class="hljs-number">2</span>)
    r &lt;- q.takeAll
  } <span class="hljs-keyword">yield</span> (r)

  <span class="hljs-keyword">val</span> catsApp = liftedToIO
    .flatMap { e =&gt;
      cats.effect.<span class="hljs-type">IO</span>.println(<span class="hljs-string">s"List of elements retrieved from Queue: <span class="hljs-subst">$e</span>"</span>)
    }
    .as(cats.effect.<span class="hljs-type">ExitCode</span>.<span class="hljs-type">Success</span>)

  catsApp.unsafeRunSync()
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="using-stm-with-cats-effect"></a><a href="#using-stm-with-cats-effect" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using STM with Cats Effect</h2>
<p>The <code>zio.interop.stm</code> provides a wrapper data type on <code>STM[Throwable, A]</code> which enables us to run <code>STM</code> with the Cats Effect library.</p>
<p>Currently, the <code>interop-cats</code> support <code>TRef</code>, <code>TPromise</code>,  <code>TQueue</code> and <code>TSemaphore</code> data types.</p>
<p>Let's try a working example using <code>STM</code> and <code>TRef</code>:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> cats.effect.<span class="hljs-type">IO</span>
<span class="hljs-keyword">import</span> cats.effect.unsafe.<span class="hljs-type">IORuntime</span>
<span class="hljs-keyword">import</span> zio.interop.stm.{<span class="hljs-type">STM</span>, <span class="hljs-type">TRef</span>}

<span class="hljs-keyword">implicit</span> <span class="hljs-keyword">val</span> zioRuntime: zio.<span class="hljs-type">Runtime</span>[zio.<span class="hljs-type">ZEnv</span>] = zio.<span class="hljs-type">Runtime</span>.<span class="hljs-keyword">default</span>
<span class="hljs-keyword">implicit</span> <span class="hljs-keyword">val</span> catsRuntime: <span class="hljs-type">IORuntime</span>            = <span class="hljs-type">IORuntime</span>.global

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">transferMoney</span></span>(
    from: <span class="hljs-type">TRef</span>[<span class="hljs-type">IO</span>, <span class="hljs-type">Long</span>],
    to: <span class="hljs-type">TRef</span>[<span class="hljs-type">IO</span>, <span class="hljs-type">Long</span>],
    amount: <span class="hljs-type">Long</span>
): <span class="hljs-type">STM</span>[<span class="hljs-type">IO</span>, <span class="hljs-type">Long</span>] =
  <span class="hljs-keyword">for</span> {
    senderBal &lt;- from.get
    _ &lt;-
      <span class="hljs-keyword">if</span> (senderBal &lt; amount)
        <span class="hljs-type">STM</span>.fail[<span class="hljs-type">IO</span>](<span class="hljs-keyword">new</span> <span class="hljs-type">Exception</span>(<span class="hljs-string">"Not enough money"</span>))
      <span class="hljs-keyword">else</span>
        <span class="hljs-type">STM</span>.unit[<span class="hljs-type">IO</span>]
    _       &lt;- from.update(existing =&gt; existing - amount)
    _       &lt;- to.update(existing =&gt; existing + amount)
    recvBal &lt;- to.get
  } <span class="hljs-keyword">yield</span> recvBal

<span class="hljs-keyword">val</span> program: <span class="hljs-type">IO</span>[<span class="hljs-type">Long</span>] = <span class="hljs-keyword">for</span> {
  sndAcc &lt;- <span class="hljs-type">STM</span>.atomically[cats.effect.<span class="hljs-type">IO</span>, <span class="hljs-type">TRef</span>[<span class="hljs-type">IO</span>, <span class="hljs-type">Long</span>]](
    <span class="hljs-type">TRef</span>.make[<span class="hljs-type">IO</span>, <span class="hljs-type">Long</span>](<span class="hljs-number">1000</span>)
  )
  rcvAcc &lt;- <span class="hljs-type">STM</span>.atomically[cats.effect.<span class="hljs-type">IO</span>, <span class="hljs-type">TRef</span>[<span class="hljs-type">IO</span>, <span class="hljs-type">Long</span>]](
    <span class="hljs-type">TRef</span>.make[<span class="hljs-type">IO</span>, <span class="hljs-type">Long</span>](<span class="hljs-number">200</span>)
  )
  recvAmt &lt;- <span class="hljs-type">STM</span>.atomically(transferMoney(sndAcc, rcvAcc, <span class="hljs-number">500</span>L))
} <span class="hljs-keyword">yield</span> recvAmt

program
  .flatMap(amount =&gt;
    <span class="hljs-type">IO</span>.println(<span class="hljs-string">s"Balance of second account after transaction: <span class="hljs-subst">$amount</span>"</span>)
  )
  .unsafeRunSync()
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="examples"></a><a href="#examples" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Examples</h2>
<p>Cats Effect and Type-Level libraries are older than the ZIO ecosystem. So there are very nice libraries like doobie and http4s, that a ZIO user would like to use in its application.</p>
<p>We have provided some full working example of using these important libraries:</p>
<h3><a class="anchor" aria-hidden="true" id="using-zio-with-doobie"></a><a href="#using-zio-with-doobie" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using ZIO with Doobie</h3>
<p>The following example shows how to use ZIO with Doobie (a library for JDBC access) and FS2 (a streaming library), which both rely on Cats Effect instances:</p>
<pre><code class="hljs css language-scala">// This snippet works with both CE2 and CE3
import doobie._
import doobie.implicits._
import fs2.Stream
import zio.Task
import zio.interop.catz._

implicit val zioRuntime: zio.Runtime[zio.ZEnv] = zio.Runtime.default

case class User(id: String, name: String, age: Int)

def xa: Transactor[Task] =
  Transactor.fromDriverManager[Task](
    "org.h2.Driver",
    "jdbc:h2:mem:users;DB_CLOSE_DELAY=-1"
  )

def createTable: doobie.ConnectionIO[Int] =
  sql"""|CREATE TABLE IF NOT EXISTS USERS(
        |id   INT SERIAL UNIQUE,
        |name VARCHAR NOT NULL UNIQUE,
        |age  SMALLINT
        |)""".stripMargin.update.run

def dropTable: doobie.ConnectionIO[Int] =
  sql"""DROP TABLE IF EXISTS USERS""".update.run

def insert(name: String, age: Int): doobie.ConnectionIO[Int] =
  sql"insert into users (name, age) values ($name, $age)".update.run

def loadUsers: Stream[doobie.ConnectionIO, User] =
  sql"""SELECT * FROM users""".query[User].stream

val doobieApp: Stream[doobie.ConnectionIO, User] = for {
  _ &lt;- fs2.Stream.eval(dropTable)
  _ &lt;- fs2.Stream.eval(createTable)
  _ &lt;- fs2.Stream.eval(insert("Olivia", 21))
  _ &lt;- fs2.Stream.eval(insert("Oliver", 30))
  u &lt;- loadUsers
} yield u

val run: Stream[Task, User] = doobieApp.transact(xa)

val allUsers: List[User] =
  zioRuntime.unsafeRun(run.compile.toList)
</code></pre>
<p>Sounds good, but how can we specify a specialized transactor than the default one? Creating a customized transactor in CE2 differs from CE3.</p>
<p>Let's try doing that in each of which:</p>
<h4><a class="anchor" aria-hidden="true" id="customized-transactor-ce2"></a><a href="#customized-transactor-ce2" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Customized Transactor (CE2)</h4>
<p>ZIO provides a specific blocking thread pool for blocking operations. The <code>doobie-hikari</code> module helps us create a transactor with two separated executors, one for blocking operations like JDBC operations, and the other one for non-blocking operations like performing awaiting connections to the database. So we shouldn't run blocking JDBC operations on the main thread pool.</p>
<p>So let's fix this issue in the previous example. In the following snippet we are going to create a <code>ZMHikari</code> of Hikari transactor. In this example we are using <code>0.13.4</code> version of doobie which supports CE2:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> zio.<span class="hljs-type">ZManaged</span>
<span class="hljs-keyword">import</span> zio.{ <span class="hljs-type">Runtime</span>, <span class="hljs-type">Task</span>, <span class="hljs-type">ZIO</span>, <span class="hljs-type">ZManaged</span> }
<span class="hljs-keyword">import</span> doobie.hikari.<span class="hljs-type">HikariTransactor</span>
<span class="hljs-keyword">import</span> cats.effect.<span class="hljs-type">Blocker</span>
<span class="hljs-keyword">import</span> zio.interop.catz._

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">transactor</span></span>: <span class="hljs-type">ZManaged</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Throwable</span>, <span class="hljs-type">HikariTransactor</span>[<span class="hljs-type">Task</span>]] =
  <span class="hljs-keyword">for</span> {
    rt &lt;- <span class="hljs-type">ZIO</span>.runtime[<span class="hljs-type">Any</span>].toManaged
    be &lt;- <span class="hljs-type">ZIO</span>.blockingExecutor.toManaged            <span class="hljs-comment">// our blocking EC</span>
    xa &lt;- <span class="hljs-type">HikariTransactor</span>
            .newHikariTransactor[<span class="hljs-type">Task</span>](
              <span class="hljs-string">"org.h2.Driver"</span>,                      <span class="hljs-comment">// driver classname</span>
              <span class="hljs-string">"jdbc:h2:mem:test;DB_CLOSE_DELAY=-1"</span>, <span class="hljs-comment">// connect URL</span>
              <span class="hljs-string">"sa"</span>,                                 <span class="hljs-comment">// username</span>
              <span class="hljs-string">""</span>,                                   <span class="hljs-comment">// password</span>
              rt.platform.executor.asEC,            <span class="hljs-comment">// await connection here</span>
              <span class="hljs-type">Blocker</span>.liftExecutionContext(be.asEC) <span class="hljs-comment">// execute JDBC operations here</span>
            )
            .toManagedZIO
  } <span class="hljs-keyword">yield</span> xa
</code></pre>
<p>Now we can <code>transact</code> our <code>doobieApp</code> with this <code>transactor</code> and convert that to the <code>ZIO</code> effect:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> zioApp: <span class="hljs-type">ZIO</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Throwable</span>, <span class="hljs-type">List</span>[<span class="hljs-type">User</span>]] =
  transactor.use(xa =&gt; doobieApp.transact(xa).compile.toList)
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="customized-transactor-ce3"></a><a href="#customized-transactor-ce3" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Customized Transactor (CE3)</h4>
<p>In Cats Effect 3.x, the <code>cats.effect.Blocker</code> has been removed. So the transactor constructor doesn't require us a blocking executor; it happens under the hood using the <code>Sync[F].blocking</code> operation.</p>
<p>To create a <code>Transactor</code> in CE3, we need to create an instance of <code>Dispatcher</code> for <code>zio.Task</code>. The following example is based on Doobie's <code>1.0.0-M5</code> version which supports CE3:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> doobie.hikari.<span class="hljs-type">HikariTransactor</span>
<span class="hljs-keyword">import</span> zio.interop.catz._
<span class="hljs-keyword">import</span> zio.{<span class="hljs-type">Task</span>, <span class="hljs-type">ZIO</span>, <span class="hljs-type">ZManaged</span>}

<span class="hljs-keyword">implicit</span> <span class="hljs-keyword">val</span> zioRuntime: zio.<span class="hljs-type">Runtime</span>[zio.<span class="hljs-type">ZEnv</span>] =
  zio.<span class="hljs-type">Runtime</span>.<span class="hljs-keyword">default</span>

<span class="hljs-keyword">implicit</span> <span class="hljs-keyword">val</span> dispatcher: cats.effect.std.<span class="hljs-type">Dispatcher</span>[zio.<span class="hljs-type">Task</span>] =
  zioRuntime
    .unsafeRun(
      cats.effect.std
        .<span class="hljs-type">Dispatcher</span>[zio.<span class="hljs-type">Task</span>]
        .allocated
    )
    ._1

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">transactor</span></span>: <span class="hljs-type">ZManaged</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Throwable</span>, <span class="hljs-type">HikariTransactor</span>[<span class="hljs-type">Task</span>]] =
  <span class="hljs-keyword">for</span> {
    rt &lt;- <span class="hljs-type">ZIO</span>.runtime[<span class="hljs-type">Any</span>].toManaged
    xa &lt;-
      <span class="hljs-type">HikariTransactor</span>
        .newHikariTransactor[<span class="hljs-type">Task</span>](
          <span class="hljs-string">"org.h2.Driver"</span>,                      <span class="hljs-comment">// driver classname</span>
          <span class="hljs-string">"jdbc:h2:mem:test;DB_CLOSE_DELAY=-1"</span>, <span class="hljs-comment">// connect URL</span>
          <span class="hljs-string">"sa"</span>,                                 <span class="hljs-comment">// username</span>
          <span class="hljs-string">""</span>,                                   <span class="hljs-comment">// password</span>
          rt.platform.executor.asEC             <span class="hljs-comment">// await connection here</span>
        )
        .toManaged
  } <span class="hljs-keyword">yield</span> xa
</code></pre>
<p>Now we can <code>transact</code> our <code>doobieApp</code> with this <code>transactor</code> and convert that to the <code>ZIO</code> effect:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> zioApp: <span class="hljs-type">ZIO</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Throwable</span>, <span class="hljs-type">List</span>[<span class="hljs-type">User</span>]] =
  transactor.use(xa =&gt; doobieApp.transact(xa).compile.toList)
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="http4s"></a><a href="#http4s" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Http4s</h3>
<p>Here is the full working example of using http4s in ZIO App:</p>
<h4><a class="anchor" aria-hidden="true" id="cats-effect-2x-2"></a><a href="#cats-effect-2x-2" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cats Effect 2.x</h4>
<p>The following example is based on http4s's <code>0.21.24</code> version which supports CE2:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> cats.effect.{<span class="hljs-type">ConcurrentEffect</span>, <span class="hljs-type">Sync</span>, <span class="hljs-type">Timer</span>}
<span class="hljs-keyword">import</span> cats.implicits._
<span class="hljs-keyword">import</span> fs2.<span class="hljs-type">Stream</span>
<span class="hljs-keyword">import</span> org.http4s.<span class="hljs-type">HttpRoutes</span>
<span class="hljs-keyword">import</span> org.http4s.client.blaze.<span class="hljs-type">BlazeClientBuilder</span>
<span class="hljs-keyword">import</span> org.http4s.dsl.<span class="hljs-type">Http4sDsl</span>
<span class="hljs-keyword">import</span> org.http4s.server.blaze.<span class="hljs-type">BlazeServerBuilder</span>
<span class="hljs-keyword">import</span> zio.interop.catz._
<span class="hljs-keyword">import</span> zio.interop.catz.implicits._ 
<span class="hljs-keyword">import</span> zio.{<span class="hljs-type">Task</span>, <span class="hljs-type">URIO</span>}

<span class="hljs-keyword">import</span> scala.concurrent.<span class="hljs-type">ExecutionContext</span>.global

<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">ZioHttp4sInterop</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CatsApp</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span></span>(args: <span class="hljs-type">List</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">URIO</span>[zio.<span class="hljs-type">ZEnv</span>, zio.<span class="hljs-type">ExitCode</span>] =
    stream[<span class="hljs-type">Task</span>].compile.drain.exitCode
  
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">stream</span></span>[<span class="hljs-type">F</span>[_]: <span class="hljs-type">ConcurrentEffect</span>: <span class="hljs-type">Timer</span>]: <span class="hljs-type">Stream</span>[<span class="hljs-type">F</span>, <span class="hljs-type">Nothing</span>] = {
    <span class="hljs-keyword">import</span> org.http4s.implicits._
    <span class="hljs-keyword">val</span> httpApp = helloWorldRoute[<span class="hljs-type">F</span>].orNotFound
    <span class="hljs-keyword">for</span> {
      _ &lt;- <span class="hljs-type">BlazeClientBuilder</span>[<span class="hljs-type">F</span>](global).stream
      exitCode &lt;- <span class="hljs-type">BlazeServerBuilder</span>[<span class="hljs-type">F</span>](global)
        .bindHttp(<span class="hljs-number">8080</span>, <span class="hljs-string">"0.0.0.0"</span>)
        .withHttpApp(httpApp)
        .serve
    } <span class="hljs-keyword">yield</span> exitCode
  }.drain

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">helloWorldRoute</span></span>[<span class="hljs-type">F</span>[_]: <span class="hljs-type">Sync</span>]: <span class="hljs-type">HttpRoutes</span>[<span class="hljs-type">F</span>] = {
    <span class="hljs-keyword">val</span> dsl = <span class="hljs-keyword">new</span> <span class="hljs-type">Http4sDsl</span>[<span class="hljs-type">F</span>]{}
    <span class="hljs-keyword">import</span> dsl._
    <span class="hljs-type">HttpRoutes</span>.strict[<span class="hljs-type">F</span>] {
      <span class="hljs-keyword">case</span> <span class="hljs-type">GET</span> -&gt; <span class="hljs-type">Root</span> =&gt;
        <span class="hljs-type">Ok</span>(<span class="hljs-string">"Hello, World!"</span>)
    }
  }
}
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="cats-effect-3x-2"></a><a href="#cats-effect-3x-2" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cats Effect 3.x</h4>
<p>The following example is based on http4s's <code>0.23.0-RC1</code> version which supports CE3:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> cats.<span class="hljs-type">Applicative</span>
<span class="hljs-keyword">import</span> cats.effect.<span class="hljs-type">Async</span>
<span class="hljs-keyword">import</span> fs2.<span class="hljs-type">Stream</span>
<span class="hljs-keyword">import</span> org.http4s.<span class="hljs-type">HttpRoutes</span>
<span class="hljs-keyword">import</span> org.http4s.blaze.client.<span class="hljs-type">BlazeClientBuilder</span>
<span class="hljs-keyword">import</span> org.http4s.blaze.server.<span class="hljs-type">BlazeServerBuilder</span>
<span class="hljs-keyword">import</span> org.http4s.dsl.<span class="hljs-type">Http4sDsl</span>
<span class="hljs-keyword">import</span> zio.interop.catz._
<span class="hljs-keyword">import</span> zio.{<span class="hljs-type">Task</span>, <span class="hljs-type">URIO</span>}

<span class="hljs-keyword">import</span> scala.concurrent.<span class="hljs-type">ExecutionContext</span>.global

<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">ZioHttp4sInterop</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">zio</span>.<span class="hljs-title">interop</span>.<span class="hljs-title">catz</span>.<span class="hljs-title">CatsApp</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">stream</span></span>[<span class="hljs-type">F</span>[_]: <span class="hljs-type">Async</span>]: <span class="hljs-type">Stream</span>[<span class="hljs-type">F</span>, <span class="hljs-type">Nothing</span>] = {
    <span class="hljs-keyword">import</span> org.http4s.implicits._
    <span class="hljs-keyword">val</span> httpApp = helloWorldRoute[<span class="hljs-type">F</span>].orNotFound
    <span class="hljs-keyword">for</span> {
      _ &lt;- <span class="hljs-type">BlazeClientBuilder</span>[<span class="hljs-type">F</span>](global).stream
      exitCode &lt;- <span class="hljs-type">BlazeServerBuilder</span>[<span class="hljs-type">F</span>](global)
        .bindHttp(<span class="hljs-number">8080</span>, <span class="hljs-string">"0.0.0.0"</span>)
        .withHttpApp(httpApp)
        .serve
    } <span class="hljs-keyword">yield</span> exitCode
  }.drain

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">helloWorldRoute</span></span>[<span class="hljs-type">F</span>[_]: <span class="hljs-type">Applicative</span>]: <span class="hljs-type">HttpRoutes</span>[<span class="hljs-type">F</span>] = {
    <span class="hljs-keyword">val</span> dsl = <span class="hljs-keyword">new</span> <span class="hljs-type">Http4sDsl</span>[<span class="hljs-type">F</span>] {}
    <span class="hljs-keyword">import</span> dsl._
    <span class="hljs-type">HttpRoutes</span>.strict[<span class="hljs-type">F</span>] { <span class="hljs-keyword">case</span> <span class="hljs-type">GET</span> -&gt; <span class="hljs-type">Root</span> =&gt;
      <span class="hljs-type">Ok</span>(<span class="hljs-string">"Hello, World!"</span>)
    }
  }

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span></span>(args: <span class="hljs-type">List</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">URIO</span>[zio.<span class="hljs-type">ZEnv</span>, zio.<span class="hljs-type">ExitCode</span>] =
    stream[<span class="hljs-type">Task</span>].compile.drain.exitCode
}
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/howto/use-zio-macros"><span class="arrow-prev">← </span><span>How to use ZIO Macros?</span></a><a class="docs-next button" href="/docs/howto/interop/with-future"><span>How to Interop with Future?</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#introduction">Introduction</a></li><li><a href="#cats-effect-instances">Cats Effect Instances</a><ul class="toc-headings"><li><a href="#providing-runtime-manually">Providing Runtime Manually</a></li><li><a href="#using-catsapp-runtime">Using <code>CatsApp</code> Runtime</a></li></ul></li><li><a href="#cats-effect-2x">Cats Effect 2.x</a><ul class="toc-headings"><li><a href="#timer-instance">Timer Instance</a></li><li><a href="#converting-resource-to-zmanaged">Converting Resource to ZManaged</a></li><li><a href="#converting-zmanaged-to-resource">Converting ZManaged to Resource</a></li></ul></li><li><a href="#cats-effect-3x">Cats Effect 3.x</a><ul class="toc-headings"><li><a href="#type-class-instances-for-zios-task">Type class Instances for ZIO's Task</a></li><li><a href="#converting-resource-to-zmanaged-1">Converting Resource to ZManaged</a></li></ul></li><li><a href="#cats-core">Cats Core</a></li><li><a href="#fs2-streams">FS2 Streams</a><ul class="toc-headings"><li><a href="#from-fs2-stream-to-zstream">From FS2 Stream to ZStream</a></li><li><a href="#from-zstream-to-fs2-stream">From ZStream to FS2 Stream</a></li></ul></li><li><a href="#using-zqueue-with-cats-effect">Using ZQueue with Cats Effect</a><ul class="toc-headings"><li><a href="#cats-effect-2x-1">Cats Effect 2.x</a></li><li><a href="#cats-effect-3x-1">Cats Effect 3.x</a></li></ul></li><li><a href="#using-stm-with-cats-effect">Using STM with Cats Effect</a></li><li><a href="#examples">Examples</a><ul class="toc-headings"><li><a href="#using-zio-with-doobie">Using ZIO with Doobie</a></li><li><a href="#http4s">Http4s</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/navbar_brand.png" alt="ZIO"/></a><div><h5>GitHub</h5><a href="https://github.com/zio/zio"><img src="https://img.shields.io/github/stars/zio/zio?style=social" alt="github"/></a></div><div><h5>Chat with us on Discord</h5><a href="https://discord.gg/2ccFBr4"><img src="https://img.shields.io/discord/629491597070827530?logo=discord&amp;style=social" alt="discord"/></a></div><div><h5>Follow us on Twitter</h5><a href="https://twitter.com/zioscala"><img src="https://img.shields.io/twitter/follow/zioscala?label=Follow&amp;style=social" alt="twitter"/></a></div><div><h5>Additional resources</h5><a href="https://javadoc.io/doc/dev.zio/zio_2.12/">Scaladoc of zio</a></div><div><a href="https://www.netlify.com"><img src="https://www.netlify.com/img/global/badges/netlify-color-accent.svg" alt="Deploys by Netlify"/></a></div></section><section class="copyright">Copyright © 2021 ZIO Maintainers</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '0c94b59071da7001757d08ab43d9e033',
                indexName: 'zio',
                inputSelector: '#search_input_react',
                algoliaOptions: {}
              });
            </script></body></html>