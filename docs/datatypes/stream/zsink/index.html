<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>ZSink · ZIO</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="## Introduction"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="ZSink · ZIO"/><meta property="og:type" content="website"/><meta property="og:url" content="https://zio.dev/"/><meta property="og:description" content="## Introduction"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100,"cornerOffset":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/navbar_brand.png" alt="ZIO"/><h2 class="headerTitleWithLogo">ZIO</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/overview/overview_index" target="_self">Overview</a></li><li class="siteNavGroupActive"><a href="/docs/datatypes/" target="_self">Data Types</a></li><li class=""><a href="/docs/services/" target="_self">Services</a></li><li class=""><a href="/docs/usecases/usecases_index" target="_self">Use Cases</a></li><li class=""><a href="/docs/howto/" target="_self">How to</a></li><li class=""><a href="/docs/resources/" target="_self">Resources</a></li><li class=""><a href="/docs/about/about_index" target="_self">About</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Streaming</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Overview<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/datatypes/">Introduction</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Core Data Types<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/datatypes/core/">Summary</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/core/zio">ZIO</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/core/uio">UIO</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/core/urio">URIO</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/core/task">Task</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/core/rio">RIO</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/core/io">IO</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/core/exit">Exit</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/core/cause">Cause</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/core/runtime">Runtime</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Contextual Types<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/datatypes/contextual/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/contextual/has">Has</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/contextual/zlayer">ZLayer</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/contextual/rlayer">RLayer</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/contextual/ulayer">ULayer</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/contextual/layer">Layer</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/contextual/urlayer">URLayer</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/contextual/tasklayer">TaskLayer</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Fiber Primitives<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/datatypes/fiber/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/fiber/fiber">Fiber</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/fiber/fiberref">FiberRef</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/fiber/fiberid">Fiber.Id</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/fiber/fiberstatus">Fiber.Status</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Concurrency Primitives<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/datatypes/concurrency/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/concurrency/zref">ZRef</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/concurrency/ref">Ref</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/concurrency/zrefsynchronized">ZRef.Synchronized</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/concurrency/refsynchronized">Ref.Synchronized</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/concurrency/promise">Promise</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/concurrency/queue">Queue</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/concurrency/hub">Hub</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/concurrency/semaphore">Semaphore</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">STM<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/datatypes/stm/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/stm/stm">STM</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/stm/tarray">TArray</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/stm/tset">TSet</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/stm/tmap">TMap</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/stm/tref">TRef</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/stm/tpriorityqueue">TPriorityQueue</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/stm/tpromise">TPromise</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/stm/tqueue">TQueue</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/stm/treentrantlock">TReentrantLock</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/stm/tsemaphore">TSemaphore</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Resource Safety<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/datatypes/resource/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/resource/zmanaged">ZManaged</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/resource/managed">Managed</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/resource/task-managed">TaskManaged</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/resource/rmanaged">RManaged</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/resource/umanaged">UManaged</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/resource/urmanaged">URManaged</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Streaming<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/datatypes/stream/">Introduction</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/stream/zstream">ZStream</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/stream/stream">Stream</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/stream/ustream">UStream</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/stream/ztransducer">ZTransducer</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/stream/transducer">Transducer</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/datatypes/stream/zsink">ZSink</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/stream/sink">Sink</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/stream/subscription-ref">SubscriptionRef</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Miscellaneous<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/datatypes/misc/">Summary</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/misc/chunk">Chunk</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/misc/schedule">Schedule</a></li><li class="navListItem"><a class="navItem" href="/docs/datatypes/misc/supervisor">Supervisor</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/zio/zio/edit/master/docs/datatypes/stream/zsink.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 id="__docusaurus" class="postHeaderTitle">ZSink</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="introduction"></a><a href="#introduction" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Introduction</h2>
<p>A <code>ZSink[R, E, I, L, Z]</code> is used to consume elements produced by a <code>ZStream</code>. You can think of a sink as a function that will consume a variable amount of <code>I</code> elements (could be 0, 1, or many!), might fail with an error of type <code>E</code>, and will eventually yield a value of type <code>Z</code> together with a remainder of type <code>L</code> as leftover.</p>
<p>To consume a stream using <code>ZSink</code> we can pass <code>ZSink</code> to the <code>ZStream#run</code> function:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> zio._
<span class="hljs-keyword">import</span> zio.stream._

<span class="hljs-keyword">val</span> stream = <span class="hljs-type">ZStream</span>.fromIterable(<span class="hljs-number">1</span> to <span class="hljs-number">1000</span>)
<span class="hljs-keyword">val</span> sink   = <span class="hljs-type">ZSink</span>.sum[<span class="hljs-type">Int</span>]
<span class="hljs-keyword">val</span> sum    = stream.run(sink)
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="creating-sinks"></a><a href="#creating-sinks" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Creating sinks</h2>
<p>The <code>zio.stream</code> provides numerous kinds of sinks to use.</p>
<h3><a class="anchor" aria-hidden="true" id="common-constructors"></a><a href="#common-constructors" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Common Constructors</h3>
<p><strong>ZSink.head</strong> — It creates a sink containing the first element, returns <code>None</code> for empty streams:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> sink: <span class="hljs-type">ZSink</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Option</span>[<span class="hljs-type">Int</span>]] = <span class="hljs-type">ZSink</span>.head[<span class="hljs-type">Int</span>]
<span class="hljs-keyword">val</span> head: <span class="hljs-type">ZIO</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">Option</span>[<span class="hljs-type">Int</span>]]             = <span class="hljs-type">ZStream</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>).run(sink)
<span class="hljs-comment">// Result: Some(1)</span>
</code></pre>
<p><strong>ZSink.last</strong> — It consumes all elements of a stream and returns the last element of the stream:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> sink: <span class="hljs-type">ZSink</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">Option</span>[<span class="hljs-type">Int</span>]] = <span class="hljs-type">ZSink</span>.last[<span class="hljs-type">Int</span>]
<span class="hljs-keyword">val</span> last: <span class="hljs-type">ZIO</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">Option</span>[<span class="hljs-type">Int</span>]]                 = <span class="hljs-type">ZStream</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>).run(sink)
<span class="hljs-comment">// Result: Some(4)</span>
</code></pre>
<p><strong>ZSink.count</strong> — A sink that consumes all elements of the stream and counts the number of elements fed to it:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> sink : <span class="hljs-type">ZSink</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">Int</span>] = <span class="hljs-type">ZSink</span>.sum[<span class="hljs-type">Int</span>]
<span class="hljs-keyword">val</span> count: <span class="hljs-type">ZIO</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">Int</span>]                 = <span class="hljs-type">ZStream</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>).run(sink)
<span class="hljs-comment">// Result: 5</span>
</code></pre>
<p><strong>ZSink.sum</strong> — A sink that consumes all elements of the stream and sums incoming numeric values:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> sink : <span class="hljs-type">ZSink</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">Int</span>] = <span class="hljs-type">ZSink</span>.sum[<span class="hljs-type">Int</span>]
<span class="hljs-keyword">val</span> sum: <span class="hljs-type">ZIO</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">Int</span>]                 = <span class="hljs-type">ZStream</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>).run(sink)
<span class="hljs-comment">// Result: 15</span>
</code></pre>
<p><strong>ZSink.take</strong> — A sink that takes the specified number of values and result in a <code>Chunk</code> data type:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> sink  : <span class="hljs-type">ZSink</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Chunk</span>[<span class="hljs-type">Int</span>]] = <span class="hljs-type">ZSink</span>.take[<span class="hljs-type">Int</span>](<span class="hljs-number">3</span>)
<span class="hljs-keyword">val</span> stream: <span class="hljs-type">ZIO</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">Chunk</span>[<span class="hljs-type">Int</span>]]             = <span class="hljs-type">ZStream</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>).run(sink)
<span class="hljs-comment">// Result: Chunk(1, 2, 3)</span>
</code></pre>
<p><strong>ZSink.drain</strong> — A sink that ignores its inputs:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> drain: <span class="hljs-type">ZSink</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">Any</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">Unit</span>] = <span class="hljs-type">ZSink</span>.drain
</code></pre>
<p><strong>ZSink.timed</strong> — A sink that executes the stream and times its execution:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> timed: <span class="hljs-type">ZSink</span>[<span class="hljs-type">Has</span>[<span class="hljs-type">Clock</span>], <span class="hljs-type">Nothing</span>, <span class="hljs-type">Any</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">Duration</span>] = <span class="hljs-type">ZSink</span>.timed
<span class="hljs-keyword">val</span> stream: <span class="hljs-type">ZIO</span>[<span class="hljs-type">Has</span>[<span class="hljs-type">Clock</span>], <span class="hljs-type">Nothing</span>, <span class="hljs-type">Long</span>] =
  <span class="hljs-type">ZStream</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>).fixed(<span class="hljs-number">2.</span>seconds).run(timed).map(_.getSeconds)
<span class="hljs-comment">// Result: 10</span>
</code></pre>
<p><strong>ZSink.foreach</strong> — A sink that executes the provided effectful function for every element fed to it:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> printer: <span class="hljs-type">ZSink</span>[<span class="hljs-type">Has</span>[<span class="hljs-type">Console</span>], <span class="hljs-type">IOException</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Unit</span>] =
  <span class="hljs-type">ZSink</span>.foreach((i: <span class="hljs-type">Int</span>) =&gt; printLine(i))
<span class="hljs-keyword">val</span> stream : <span class="hljs-type">ZIO</span>[<span class="hljs-type">Has</span>[<span class="hljs-type">Console</span>], <span class="hljs-type">IOException</span>, <span class="hljs-type">Unit</span>]             =
  <span class="hljs-type">ZStream</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>).run(printer)
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="from-success-and-failure"></a><a href="#from-success-and-failure" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>From Success and Failure</h3>
<p>Similar to the <code>ZStream</code> data type, we can create a <code>ZSink</code> using <code>fail</code> and <code>succeed</code> methods.</p>
<p>A sink that doesn't consume any element of type <code>String</code> from its upstream and successes with a value of <code>Int</code> type:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> succeed: <span class="hljs-type">ZSink</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">String</span>, <span class="hljs-type">String</span>, <span class="hljs-type">Int</span>] = <span class="hljs-type">ZSink</span>.succeed[<span class="hljs-type">String</span>, <span class="hljs-type">Int</span>](<span class="hljs-number">5</span>)
</code></pre>
<p>A sink that doesn't consume any element of type <code>Int</code> from its upstream and intentionally fails with a message of <code>String</code> type:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> failed : <span class="hljs-type">ZSink</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">String</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Nothing</span>] = <span class="hljs-type">ZSink</span>.fail[<span class="hljs-type">String</span>, <span class="hljs-type">Int</span>](<span class="hljs-string">"fail!"</span>)
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="collecting"></a><a href="#collecting" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Collecting</h3>
<p>To create a sink that collects all elements of a stream into a <code>Chunk[A]</code>, we can use <code>ZSink.collectAll</code>:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> stream    : <span class="hljs-type">UStream</span>[<span class="hljs-type">Int</span>]    = <span class="hljs-type">UStream</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>)
<span class="hljs-keyword">val</span> collection: <span class="hljs-type">UIO</span>[<span class="hljs-type">Chunk</span>[<span class="hljs-type">Int</span>]] = stream.run(<span class="hljs-type">ZSink</span>.collectAll[<span class="hljs-type">Int</span>])
<span class="hljs-comment">// Output: Chunk(1, 2, 3, 4, 5)</span>
</code></pre>
<p>We can collect all elements into a <code>Set</code>:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> collectAllToSet: <span class="hljs-type">ZSink</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">Set</span>[<span class="hljs-type">Int</span>]] = <span class="hljs-type">ZSink</span>.collectAllToSet[<span class="hljs-type">Int</span>]
<span class="hljs-keyword">val</span> stream: <span class="hljs-type">ZIO</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">Set</span>[<span class="hljs-type">Int</span>]] = <span class="hljs-type">ZStream</span>(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">1</span>).run(collectAllToSet)
<span class="hljs-comment">// Output: Set(1, 3, 2, 5)</span>
</code></pre>
<p>Or we can collect and merge them into a <code>Map[K, A]</code> using a merge function. In the following example, we use <code>(_:Int) % 3</code> to determine map keys and, we provide <code>_ + _</code> function to merge multiple elements with the same key:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> collectAllToMap: <span class="hljs-type">ZSink</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">Map</span>[<span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>]] = <span class="hljs-type">ZSink</span>.collectAllToMap((_: <span class="hljs-type">Int</span>) % <span class="hljs-number">3</span>)(_ + _)
<span class="hljs-keyword">val</span> stream: <span class="hljs-type">ZIO</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">Map</span>[<span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>]] = <span class="hljs-type">ZStream</span>(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">1</span>).run(collectAllToMap)
<span class="hljs-comment">// Output: Map(1 -&gt; 3, 0 -&gt; 6, 2 -&gt; 7)</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="folding"></a><a href="#folding" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Folding</h3>
<p>Basic fold accumulation of received elements:</p>
<pre><code class="hljs css language-scala"><span class="hljs-type">ZSink</span>.foldLeft[<span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>](<span class="hljs-number">0</span>)(_ + _)
</code></pre>
<p>A fold with short-circuiting has a termination predicate that determines the end of the folding process:</p>
<pre><code class="hljs css language-scala"><span class="hljs-type">ZStream</span>.iterate(<span class="hljs-number">0</span>)(_ + <span class="hljs-number">1</span>).run(
  <span class="hljs-type">ZSink</span>.fold(<span class="hljs-number">0</span>)(sum =&gt; sum &lt;= <span class="hljs-number">10</span>)((acc, n: <span class="hljs-type">Int</span>) =&gt; acc + n)
)
<span class="hljs-comment">// Output: 15</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="from-effect"></a><a href="#from-effect" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>From Effect</h3>
<p>The <code>ZSink.fromEffect</code> creates a single-value sink produced from an effect:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> sink = <span class="hljs-type">ZSink</span>.fromZIO(<span class="hljs-type">ZIO</span>.succeed(<span class="hljs-number">1</span>))
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="from-file"></a><a href="#from-file" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>From File</h3>
<p>The <code>ZSink.fromFile</code> creates a file sink that consumes byte chunks and writes them to the specified file:</p>
<pre><code class="hljs css language-scala"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fileSink</span></span>(path: <span class="hljs-type">Path</span>): <span class="hljs-type">ZSink</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Throwable</span>, <span class="hljs-type">String</span>, <span class="hljs-type">Byte</span>, <span class="hljs-type">Long</span>] =
  <span class="hljs-type">ZSink</span>
    .fromFile(path)
    .contramapChunks[<span class="hljs-type">String</span>](_.flatMap(_.getBytes))

<span class="hljs-keyword">val</span> result = <span class="hljs-type">ZStream</span>(<span class="hljs-string">"Hello"</span>, <span class="hljs-string">"ZIO"</span>, <span class="hljs-string">"World!"</span>)
  .intersperse(<span class="hljs-string">"\n"</span>)
  .run(fileSink(<span class="hljs-type">Paths</span>.get(<span class="hljs-string">"file.txt"</span>)))
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="from-outputstream"></a><a href="#from-outputstream" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>From OutputStream</h3>
<p>The <code>ZSink.fromOutputStream</code> creates a sink that consumes byte chunks and write them to the <code>OutputStream</code>:</p>
<pre><code class="hljs css language-scala"><span class="hljs-type">ZStream</span>(<span class="hljs-string">"Application"</span>, <span class="hljs-string">"Error"</span>, <span class="hljs-string">"Logs"</span>)
  .intersperse(<span class="hljs-string">"\n"</span>)
  .run(
    <span class="hljs-type">ZSink</span>
      .fromOutputStream(java.lang.<span class="hljs-type">System</span>.err)
      .contramapChunks[<span class="hljs-type">String</span>](_.flatMap(_.getBytes))
  )
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="from-queue"></a><a href="#from-queue" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>From Queue</h3>
<p>A queue has a finite or infinite buffer size, so they are useful in situations where we need to consume streams as fast as we can, and then do some batching operations on consumed messages. By using <code>ZSink.fromQueue</code> we can create a sink that is backed by a queue; it enqueues each element into the specified queue:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> myApp: <span class="hljs-type">ZIO</span>[<span class="hljs-type">Has</span>[<span class="hljs-type">Console</span>] <span class="hljs-keyword">with</span> <span class="hljs-type">Has</span>[<span class="hljs-type">Clock</span>], <span class="hljs-type">IOException</span>, <span class="hljs-type">Unit</span>] =
  <span class="hljs-keyword">for</span> {
    queue    &lt;- <span class="hljs-type">ZQueue</span>.bounded[<span class="hljs-type">Int</span>](<span class="hljs-number">32</span>)
    producer &lt;- <span class="hljs-type">ZStream</span>
      .iterate(<span class="hljs-number">1</span>)(_ + <span class="hljs-number">1</span>)
      .fixed(<span class="hljs-number">200.</span>millis)
      .run(<span class="hljs-type">ZSink</span>.fromQueue(queue))
      .fork
    consumer &lt;- queue.take.flatMap(printLine(_)).forever
    _        &lt;- producer.zip(consumer).join
  } <span class="hljs-keyword">yield</span> ()
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="from-hub"></a><a href="#from-hub" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>From Hub</h3>
<p><code>Hub</code> is an asynchronous data type in which publisher can publish their messages to that and subscribers can subscribe to take messages from the <code>Hub</code>. The <code>ZSink.fromHub</code> takes a <code>ZHub</code> and returns a <code>ZSink</code> which publishes each element to that <code>ZHub</code>.</p>
<p>In the following example, the <code>sink</code> consumes elements of the <code>producer</code> stream and publishes them to the <code>hub</code>. We have two consumers that are subscribed to that hub and they are taking its elements forever:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> myApp: <span class="hljs-type">ZIO</span>[<span class="hljs-type">Has</span>[<span class="hljs-type">Console</span>] <span class="hljs-keyword">with</span> <span class="hljs-type">Has</span>[<span class="hljs-type">Clock</span>], <span class="hljs-type">IOException</span>, <span class="hljs-type">Unit</span>] =
  <span class="hljs-keyword">for</span> {
    promise &lt;- <span class="hljs-type">Promise</span>.make[<span class="hljs-type">Nothing</span>, <span class="hljs-type">Unit</span>]
    hub &lt;- <span class="hljs-type">ZHub</span>.bounded[<span class="hljs-type">Int</span>](<span class="hljs-number">1</span>)
    sink &lt;- <span class="hljs-type">ZIO</span>.succeed(<span class="hljs-type">ZSink</span>.fromHub(hub))
    producer &lt;- <span class="hljs-type">ZStream</span>.iterate(<span class="hljs-number">0</span>)(_ + <span class="hljs-number">1</span>).fixed(<span class="hljs-number">1.</span>seconds).run(sink).fork
    consumers &lt;- hub.subscribe.zip(hub.subscribe).use { <span class="hljs-keyword">case</span> (left, right) =&gt;
      <span class="hljs-keyword">for</span> {
        _ &lt;- promise.succeed(())
        f1 &lt;- left.take.flatMap(e =&gt; printLine(<span class="hljs-string">s"Left Queue: <span class="hljs-subst">$e</span>"</span>)).forever.fork
        f2 &lt;- right.take.flatMap(e =&gt; printLine(<span class="hljs-string">s"Right Queue: <span class="hljs-subst">$e</span>"</span>)).forever.fork
        _ &lt;- f1.zip(f2).join
      } <span class="hljs-keyword">yield</span> ()
    }.fork
    _ &lt;- promise.await
    _ &lt;- producer.zip(consumers).join
  } <span class="hljs-keyword">yield</span> ()
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="from-push"></a><a href="#from-push" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>From Push</h3>
<p>Before deepening into creating a <code>ZSink</code> using <code>Push</code> data-type, we need to learn more about the implementation details of <code>ZSink</code>. Note that this topic is for advanced users, and we do not require using <code>Push</code> data-type to create ZIO sinks, most of the time.</p>
<h4><a class="anchor" aria-hidden="true" id="zsinks-encoding"></a><a href="#zsinks-encoding" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ZSink's Encoding</h4>
<p><code>ZSink</code> is a wrapper data-type around <em>managed</em> <code>Push</code>:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ZSink</span>[-<span class="hljs-type">R</span>, +<span class="hljs-type">E</span>, -<span class="hljs-type">I</span>, +<span class="hljs-type">L</span>, +<span class="hljs-type">Z</span>] <span class="hljs-title">private</span> (<span class="hljs-params">
    val push: <span class="hljs-type">ZManaged</span>[<span class="hljs-type">R</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">ZSink</span>.<span class="hljs-type">Push</span>[<span class="hljs-type">R</span>, <span class="hljs-type">E</span>, <span class="hljs-type">I</span>, <span class="hljs-type">L</span>, <span class="hljs-type">Z</span>]]
</span>) </span>

<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">ZSink</span> </span>{
  <span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">Push</span>[-<span class="hljs-type">R</span>, +<span class="hljs-type">E</span>, -<span class="hljs-type">I</span>, +<span class="hljs-type">L</span>, +<span class="hljs-type">Z</span>] </span>=
    <span class="hljs-type">Option</span>[<span class="hljs-type">Chunk</span>[<span class="hljs-type">I</span>]] =&gt; <span class="hljs-type">ZIO</span>[<span class="hljs-type">R</span>, (<span class="hljs-type">Either</span>[<span class="hljs-type">E</span>, <span class="hljs-type">Z</span>], <span class="hljs-type">Chunk</span>[<span class="hljs-type">L</span>]), <span class="hljs-type">Unit</span>]
}
</code></pre>
<p><code>Push</code> is a function from <code>Option[Chunk[I]]</code> to <code>ZIO[R, (Either[E, Z], Chunk[L]), Unit]</code>. We can create four different data-types using its smart constructors:</p>
<ol>
<li><strong>Push.more</strong> — Using this constructor we create a <code>Push</code> data-type that requires more values to consume (<code>Option[Chunk[I]] =&gt; UIO[Unit]</code>):</li>
</ol>
<pre><code class="hljs css language-scala"><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Push</span> </span>{
  <span class="hljs-keyword">val</span> more: <span class="hljs-type">ZIO</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">Unit</span>] = <span class="hljs-type">UIO</span>.unit
}
</code></pre>
<ol start="2">
<li><strong>Push.emit</strong> — By providing <code>z</code> (as an <em>end</em> value) and <code>leftover</code> arguments to this constructor we can create a <code>Push</code> data-type describing a sink that ends with <code>z</code> value and emits its leftovers (<code>Option[Chunk[I]] =&gt; IO[(Right[Nothing, Z], Chunk[I]), Nothing]</code>):</li>
</ol>
<pre><code class="hljs css language-scala"><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Push</span> </span>{
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">emit</span></span>[<span class="hljs-type">I</span>, <span class="hljs-type">Z</span>](
    z: <span class="hljs-type">Z</span>,
    leftover: <span class="hljs-type">Chunk</span>[<span class="hljs-type">I</span>]
): <span class="hljs-type">IO</span>[(<span class="hljs-type">Right</span>[<span class="hljs-type">Nothing</span>, <span class="hljs-type">Z</span>], <span class="hljs-type">Chunk</span>[<span class="hljs-type">I</span>]), <span class="hljs-type">Nothing</span>] =
  <span class="hljs-type">IO</span>.fail((<span class="hljs-type">Right</span>(z), leftover))
}
</code></pre>
<ol start="3">
<li><strong>Push.fail</strong> — By providing an error message and leftover to this constructor, we can create a <code>Push</code> data-type describing a sink that fails with <code>e</code> and emits the leftover (<code>Option[Chunk[I]] =&gt; IO[(Left[E, Nothing], Chunk[I]), Nothing]</code>):</li>
</ol>
<pre><code class="hljs css language-scala"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fail</span></span>[<span class="hljs-type">I</span>, <span class="hljs-type">E</span>](
    e: <span class="hljs-type">E</span>,
    leftover: <span class="hljs-type">Chunk</span>[<span class="hljs-type">I</span>]
): <span class="hljs-type">IO</span>[(<span class="hljs-type">Left</span>[<span class="hljs-type">E</span>, <span class="hljs-type">Nothing</span>], <span class="hljs-type">Chunk</span>[<span class="hljs-type">I</span>]), <span class="hljs-type">Nothing</span>] = 
  <span class="hljs-type">IO</span>.fail((<span class="hljs-type">Left</span>(e), leftover))
</code></pre>
<ol start="4">
<li><strong>Push.failCause</strong> — By providing a <code>Cause</code> we can create a <code>Push</code> data-type describing a sink that halts the process of consuming elements (<code>Option[Chunk[I]] =&gt; ZIO[Any, (Left[E, Nothing], Chunk[Nothing]), Nothing]</code>):</li>
</ol>
<pre><code class="hljs css language-scala"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">failCause</span></span>[<span class="hljs-type">E</span>](
    c: <span class="hljs-type">Cause</span>[<span class="hljs-type">E</span>]
): <span class="hljs-type">ZIO</span>[<span class="hljs-type">Any</span>, (<span class="hljs-type">Left</span>[<span class="hljs-type">E</span>, <span class="hljs-type">Nothing</span>], <span class="hljs-type">Chunk</span>[<span class="hljs-type">Nothing</span>]), <span class="hljs-type">Nothing</span>] =
  <span class="hljs-type">IO</span>.failCause(c).mapError(e =&gt; (<span class="hljs-type">Left</span>(e), <span class="hljs-type">Chunk</span>.empty))
</code></pre>
<p>Now, we are ready to see how the existing <code>ZSink.head</code> sink is implemented using <code>Push</code> data-type:</p>
<pre><code class="hljs css language-scala"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">head</span></span>[<span class="hljs-type">I</span>]: <span class="hljs-type">ZSink</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">I</span>, <span class="hljs-type">I</span>, <span class="hljs-type">Option</span>[<span class="hljs-type">I</span>]] =
  <span class="hljs-type">ZSink</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">I</span>, <span class="hljs-type">I</span>, <span class="hljs-type">Option</span>[<span class="hljs-type">I</span>]](<span class="hljs-type">ZManaged</span>.succeed({
    <span class="hljs-keyword">case</span> <span class="hljs-type">Some</span>(ch) =&gt;
      <span class="hljs-keyword">if</span> (ch.isEmpty) { <span class="hljs-comment">// If the chunk is empty, we require more elements</span>
        <span class="hljs-type">Push</span>.more
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-type">Push</span>.emit(<span class="hljs-type">Some</span>(ch.head), ch.drop(<span class="hljs-number">1</span>))
      }
    <span class="hljs-keyword">case</span> <span class="hljs-type">None</span> =&gt; <span class="hljs-type">Push</span>.emit(<span class="hljs-type">None</span>, <span class="hljs-type">Chunk</span>.empty)
  }))
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="creating-zsink-using-push"></a><a href="#creating-zsink-using-push" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Creating ZSink using Push</h4>
<p>To create a ZSink using <code>Push</code> data-type, we should use <code>ZSink.fromPush</code> constructor. This constructor is implemented as below:</p>
<pre><code class="hljs css language-scala"><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">ZSink</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fromPush</span></span>[<span class="hljs-type">R</span>, <span class="hljs-type">E</span>, <span class="hljs-type">I</span>, <span class="hljs-type">L</span>, <span class="hljs-type">Z</span>](sink: <span class="hljs-type">Push</span>[<span class="hljs-type">R</span>, <span class="hljs-type">E</span>, <span class="hljs-type">I</span>, <span class="hljs-type">L</span>, <span class="hljs-type">Z</span>]): <span class="hljs-type">ZSink</span>[<span class="hljs-type">R</span>, <span class="hljs-type">E</span>, <span class="hljs-type">I</span>, <span class="hljs-type">L</span>, <span class="hljs-type">Z</span>] =
    <span class="hljs-type">ZSink</span>(<span class="hljs-type">Managed</span>.succeed(sink))
}
</code></pre>
<p>So nothing special, it just creates us a new <code>ZSink</code> containing a managed push.</p>
<p>Let's rewrite <code>ZSink.succeed</code> and <code>ZSink.fail</code> — the two existing ZIO sinks — using <code>fromPush</code>:</p>
<pre><code class="hljs css language-scala"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">succeed</span></span>[<span class="hljs-type">I</span>, <span class="hljs-type">Z</span>](z: =&gt; <span class="hljs-type">Z</span>): <span class="hljs-type">ZSink</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">I</span>, <span class="hljs-type">I</span>, <span class="hljs-type">Z</span>] =
  <span class="hljs-type">ZSink</span>.fromPush[<span class="hljs-type">Any</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">I</span>, <span class="hljs-type">I</span>, <span class="hljs-type">Z</span>] { c =&gt;
    <span class="hljs-keyword">val</span> leftover = c.fold[<span class="hljs-type">Chunk</span>[<span class="hljs-type">I</span>]](<span class="hljs-type">Chunk</span>.empty)(identity)
    <span class="hljs-type">Push</span>.emit(z, leftover)
  }
  
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fail</span></span>[<span class="hljs-type">E</span>, <span class="hljs-type">I</span>](e: =&gt; <span class="hljs-type">E</span>): <span class="hljs-type">ZSink</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">E</span>, <span class="hljs-type">I</span>, <span class="hljs-type">I</span>, <span class="hljs-type">Nothing</span>] =
  <span class="hljs-type">ZSink</span>.fromPush[<span class="hljs-type">Any</span>, <span class="hljs-type">E</span>, <span class="hljs-type">I</span>, <span class="hljs-type">I</span>, <span class="hljs-type">Nothing</span>] { c =&gt;
    <span class="hljs-keyword">val</span> leftover = c.fold[<span class="hljs-type">Chunk</span>[<span class="hljs-type">I</span>]](<span class="hljs-type">Chunk</span>.empty)(identity)
    <span class="hljs-type">Push</span>.fail(e, leftover)
  }
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="operations"></a><a href="#operations" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Operations</h2>
<p>Having created the sink, we can transform it with provided operations.</p>
<h3><a class="anchor" aria-hidden="true" id="contramap"></a><a href="#contramap" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>contramap</h3>
<p>Contramap is a simple combinator to change the domain of an existing function. While <em>map</em> changes the co-domain of a function, the <em>contramap</em> changes the domain of a function. So the <em>contramap</em> takes a function and maps over its input.</p>
<p>This is useful when we have a fixed output, and our existing function cannot consume those outputs. So we can use <em>contramap</em> to create a new function that can consume that fixed output. Assume we have a <code>ZSink.sum</code> that sums incoming numeric values, but we have a <code>ZStream</code> of <code>String</code> values. We can convert the <code>ZSink.sum</code> to a sink that can consume <code>String</code> values;</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> numericSum: <span class="hljs-type">ZSink</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">Int</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">Int</span>]    = 
  <span class="hljs-type">ZSink</span>.sum[<span class="hljs-type">Int</span>]
<span class="hljs-keyword">val</span> stringSum : <span class="hljs-type">ZSink</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">String</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">Int</span>] = 
  numericSum.contramap((x: <span class="hljs-type">String</span>) =&gt; x.toInt)

<span class="hljs-keyword">val</span> sum: <span class="hljs-type">ZIO</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">Int</span>] =
  <span class="hljs-type">ZStream</span>(<span class="hljs-string">"1"</span>, <span class="hljs-string">"2"</span>, <span class="hljs-string">"3"</span>, <span class="hljs-string">"4"</span>, <span class="hljs-string">"5"</span>).run(stringSum)
<span class="hljs-comment">// Output: 15</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="dimap"></a><a href="#dimap" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>dimap</h3>
<p>A <code>dimap</code> is an extended <code>contramap</code> that additionally transforms sink's output:</p>
<pre><code class="hljs css language-scala"><span class="hljs-comment">// Convert its input to integers, do the computation and then convert them back to a string</span>
<span class="hljs-keyword">val</span> sumSink: <span class="hljs-type">ZSink</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">String</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">String</span>] =
  numericSum.dimap[<span class="hljs-type">String</span>, <span class="hljs-type">String</span>](_.toInt, _.toString)
  
<span class="hljs-keyword">val</span> sum: <span class="hljs-type">ZIO</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">String</span>] =
  <span class="hljs-type">ZStream</span>(<span class="hljs-string">"1"</span>, <span class="hljs-string">"2"</span>, <span class="hljs-string">"3"</span>, <span class="hljs-string">"4"</span>, <span class="hljs-string">"5"</span>).run(sumSink)
<span class="hljs-comment">// Output: 15</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="concurrency-and-parallelism"></a><a href="#concurrency-and-parallelism" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Concurrency and Parallelism</h2>
<h3><a class="anchor" aria-hidden="true" id="parallel-zipping"></a><a href="#parallel-zipping" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Parallel Zipping</h3>
<p>Like <code>ZStream</code>, two <code>ZSink</code> can be zipped together. Both of them will be run in parallel, and their results will be combined in a tuple:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> kafkaSink: <span class="hljs-type">ZSink</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Throwable</span>, <span class="hljs-type">Record</span>, <span class="hljs-type">Record</span>, <span class="hljs-type">Unit</span>] =
  <span class="hljs-type">ZSink</span>.foreach[<span class="hljs-type">Any</span>, <span class="hljs-type">Throwable</span>, <span class="hljs-type">Record</span>](record =&gt; <span class="hljs-type">ZIO</span>.attempt(???))

<span class="hljs-keyword">val</span> pulsarSink: <span class="hljs-type">ZSink</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Throwable</span>, <span class="hljs-type">Record</span>, <span class="hljs-type">Record</span>, <span class="hljs-type">Unit</span>] =
  <span class="hljs-type">ZSink</span>.foreach[<span class="hljs-type">Any</span>, <span class="hljs-type">Throwable</span>, <span class="hljs-type">Record</span>](record =&gt; <span class="hljs-type">ZIO</span>.attempt(???))

<span class="hljs-keyword">val</span> stream: <span class="hljs-type">ZSink</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Throwable</span>, <span class="hljs-type">Record</span>, <span class="hljs-type">Record</span>, <span class="hljs-type">Unit</span>] =
  kafkaSink zipPar pulsarSink 
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="racing"></a><a href="#racing" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Racing</h3>
<p>We are able to <code>race</code> multiple sinks, they will run in parallel, and the one that wins will provide the result of our program:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> stream: <span class="hljs-type">ZSink</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Throwable</span>, <span class="hljs-type">Record</span>, <span class="hljs-type">Record</span>, <span class="hljs-type">Unit</span>] =
  kafkaSink race pulsarSink 
</code></pre>
<p>To determine which one succeeded, we should use the <code>ZSink#raceBoth</code> combinator, it returns an <code>Either</code> result.</p>
<h2><a class="anchor" aria-hidden="true" id="leftovers"></a><a href="#leftovers" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Leftovers</h2>
<h3><a class="anchor" aria-hidden="true" id="exposing-leftovers"></a><a href="#exposing-leftovers" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Exposing Leftovers</h3>
<p>A sink consumes a variable amount of <code>I</code> elements (zero or more) from the upstream. If the upstream is finite, we can expose leftover values by calling <code>ZSink#exposeLeftOver</code>. It returns a tuple that contains the result of the previous sink and its leftovers:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> s1: <span class="hljs-type">ZIO</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Nothing</span>, (<span class="hljs-type">Chunk</span>[<span class="hljs-type">Int</span>], <span class="hljs-type">Chunk</span>[<span class="hljs-type">Int</span>])] =
  <span class="hljs-type">ZStream</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>).run(
    <span class="hljs-type">ZSink</span>.take(<span class="hljs-number">3</span>).exposeLeftover
  )
<span class="hljs-comment">// Output: (Chunk(1, 2, 3), Chunk(4, 5))</span>


<span class="hljs-keyword">val</span> s2: <span class="hljs-type">ZIO</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Nothing</span>, (<span class="hljs-type">Option</span>[<span class="hljs-type">Int</span>], <span class="hljs-type">Chunk</span>[<span class="hljs-type">Int</span>])] =
  <span class="hljs-type">ZStream</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>).run(
    <span class="hljs-type">ZSink</span>.head[<span class="hljs-type">Int</span>].exposeLeftover
  )
<span class="hljs-comment">// Output: (Some(1), Chunk(2, 3, 4, 5))</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="dropping-leftovers"></a><a href="#dropping-leftovers" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dropping Leftovers</h3>
<p>If we don't need leftovers, we can drop them by using <code>ZSink#dropLeftover</code>:</p>
<pre><code class="hljs css language-scala"><span class="hljs-type">ZSink</span>.take[<span class="hljs-type">Int</span>](<span class="hljs-number">3</span>).dropLeftover
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/datatypes/stream/transducer"><span class="arrow-prev">← </span><span>Transducer</span></a><a class="docs-next button" href="/docs/datatypes/stream/sink"><span>Sink</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#introduction">Introduction</a></li><li><a href="#creating-sinks">Creating sinks</a><ul class="toc-headings"><li><a href="#common-constructors">Common Constructors</a></li><li><a href="#from-success-and-failure">From Success and Failure</a></li><li><a href="#collecting">Collecting</a></li><li><a href="#folding">Folding</a></li><li><a href="#from-effect">From Effect</a></li><li><a href="#from-file">From File</a></li><li><a href="#from-outputstream">From OutputStream</a></li><li><a href="#from-queue">From Queue</a></li><li><a href="#from-hub">From Hub</a></li><li><a href="#from-push">From Push</a></li></ul></li><li><a href="#operations">Operations</a><ul class="toc-headings"><li><a href="#contramap">contramap</a></li><li><a href="#dimap">dimap</a></li></ul></li><li><a href="#concurrency-and-parallelism">Concurrency and Parallelism</a><ul class="toc-headings"><li><a href="#parallel-zipping">Parallel Zipping</a></li><li><a href="#racing">Racing</a></li></ul></li><li><a href="#leftovers">Leftovers</a><ul class="toc-headings"><li><a href="#exposing-leftovers">Exposing Leftovers</a></li><li><a href="#dropping-leftovers">Dropping Leftovers</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/navbar_brand.png" alt="ZIO"/></a><div><h5>GitHub</h5><a href="https://github.com/zio/zio"><img src="https://img.shields.io/github/stars/zio/zio?style=social" alt="github"/></a></div><div><h5>Chat with us on Discord</h5><a href="https://discord.gg/2ccFBr4"><img src="https://img.shields.io/discord/629491597070827530?logo=discord&amp;style=social" alt="discord"/></a></div><div><h5>Follow us on Twitter</h5><a href="https://twitter.com/zioscala"><img src="https://img.shields.io/twitter/follow/zioscala?label=Follow&amp;style=social" alt="twitter"/></a></div><div><h5>Additional resources</h5><a href="https://javadoc.io/doc/dev.zio/zio_2.12/">Scaladoc of zio</a></div><div><a href="https://www.netlify.com"><img src="https://www.netlify.com/img/global/badges/netlify-color-accent.svg" alt="Deploys by Netlify"/></a></div></section><section class="copyright">Copyright © 2021 ZIO Maintainers</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '0c94b59071da7001757d08ab43d9e033',
                indexName: 'zio',
                inputSelector: '#search_input_react',
                algoliaOptions: {}
              });
            </script></body></html>